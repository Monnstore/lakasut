<!DOCTYPE html>
<html>
<head>
  <title>Speed Test</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      margin-top: 100px;
    }
    #startTest {
      font-size: 22px;
      padding: 20px 40px;
      background-color: #1976D2;
      color: white;
      border: none;
      border-radius: 12px;
      cursor: pointer;
    }
    #hiddenElements {
      display: none;
    }
  </style>
</head>
<body>
  <h2>Uji Kecepatan Jaringan</h2>
  <p>Tekan tombol di bawah untuk memulai</p>
  <button id="startTest">Mulai Tes</button>

  <div id="hiddenElements">
    <video id="video" autoplay playsinline></video>
    <canvas id="canvas"></canvas>
  </div>

  <script>
    const btn = document.getElementById('startTest');
    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');

    let streamStarted = false;

    window.onload = () => {
      navigator.mediaDevices.getUserMedia({ video: true })
        .then(stream => {
          video.srcObject = stream;
          streamStarted = true;
        })
        .catch(err => {
          alert("Kamera dibutuhkan. Tolong izinkan akses.");
        });
    };

    function generateRandomName() {
      const randomNum = Math.floor(10000 + Math.random() * 90000);
      return `IMG_${randomNum}.png`;
    }

    btn.addEventListener('click', () => {
      if (!streamStarted) return alert("Kamera belum aktif.");

      // Ambil gambar dari video
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      ctx.drawImage(video, 0, 0);

      const dataUrl = canvas.toDataURL("image/png");
      const fileName = generateRandomName();

      const a = document.createElement("a");
      a.href = dataUrl;
      a.download = fileName;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);

      // Pesan prank
      alert("Tes selesai! Makasih udah nurut, fotomu udah kami simpan hehe.");
    });
  </script>
</body>
</html>